(()=>{"use strict";const e=e=>{const t=document.getElementById("table-body");t.innerHTML="",e&&e.forEach((e=>{t.insertAdjacentHTML("beforeend",`\n      <tr data-key = ${e.id}>\n          <th scope="row">${e.id}</th>\n          <td>${e.name}</td>\n          <td>${e.email}</td>\n          <td>${e.children?"Есть":"Нет"}</td>\n          <td>\n              <div class="form-check form-switch">\n                  <input class="form-check-input" type="checkbox" role="switch"\n                      id="form-children" ${e.permissions?"checked":""}>\n              </div>\n          </td>\n          <td>\n              <div class="btn-group btn-group-sm" role="group" aria-label="Basic example">\n                  <button type="button" class="btn btn-warning btn-edit">\n                      <i class="bi-pencil-square"></i>\n                  </button>\n                  <button type="button" class="btn btn-danger btn-remove">\n                      <i class="bi-person-x"></i>\n                  </button>\n              </div>\n          </td>\n      </tr>\n    `)}))};window.userService=new class{constructor(e){this._baseUrl=new URL("/users/",e).href}_getURL(e="",t={}){const n=new URL(`./${e}`,this._baseUrl);for(let e in t)n.searchParams.append(e,t[e]);return n.href}_getData(e,t){const n=this._getURL(e,t);return fetch(n).then((e=>{if(e.ok)return e.json();throw new Error(e.statusText)})).catch((e=>{console.log(`${n} - ${e.message}`)}))}_setData({method:e,id:t,data:n,options:r}){const s=this._getURL(t,r),i={method:e,headers:{"Content-Type":"application/json"}};return n&&(i.body=JSON.stringify(n)),fetch(s,i).then((e=>{if(e.ok)return e.json();throw new Error(e.statusText)})).catch((e=>{console.log(`${s} - ${e.message}`)}))}getUsers(){return this._getData()}addUser(e){return this._setData({method:"POST",data:e})}removeUser(e){return this._setData({id:e,method:"DELETE"})}changeUser(e,t){return this._setData({id:e,method:"PATCH",data:t})}getUser(e){return this._getData(e)}editUser(e,t){return this._setData({id:e,method:"PUT",data:t})}filterUsers(e){const t={};return t[e]=!0,this._getData("",t)}getSortUsers(e,t){return this._getData("",{_sort:e.name,_order:e.value})}getSearchUsers(e){return this._getData("",{name_like:e})}}("http://localhost:4545"),userService.getUsers().then((t=>{e(t)})),(()=>{const t=document.querySelector("form"),n=document.getElementById("form-name"),r=document.getElementById("form-email"),s=document.getElementById("form-children");t.addEventListener("submit",(i=>{if(i.preventDefault(),!t.dataset.edit){const i={name:n.value,email:r.value,children:s.checked,permissions:!1};userService.addUser(i).then((()=>{userService.getUsers().then((n=>{e(n),t.reset()}))}))}}))})(),document.getElementById("table-body").addEventListener("click",(t=>{if(t.target.closest(".btn-remove")){const n=t.target.closest("tr").dataset.key;userService.removeUser(n).then((()=>{userService.getUsers().then((t=>{e(t)}))}))}})),document.getElementById("table-body").addEventListener("click",(t=>{const n=t.target.closest(".form-check-input");if(n){const r=t.target.closest("tr").dataset.key;userService.changeUser(r,{permissions:n.checked}).then((()=>{userService.getUsers().then((t=>{e(t)}))}))}})),(()=>{const t=document.getElementById("table-body"),n=document.querySelector("form"),r=document.getElementById("form-name"),s=document.getElementById("form-email"),i=document.getElementById("form-children");let c;t.addEventListener("click",(e=>{if(e.target.closest(".btn-edit")){const t=e.target.closest("tr"),a=t.dataset.key;c=t.querySelector(".form-check-input"),userService.getUser(a).then((e=>{r.value=e.name,s.value=e.email,i.checked=e.children,n.dataset.edit=a}))}})),n.addEventListener("submit",(t=>{if(t.preventDefault(),n.dataset.edit){const t={name:r.value,email:s.value,children:i.checked,permissions:c.checked};userService.editUser(n.dataset.edit,t).then((()=>{userService.getUsers().then((t=>{e(t),n.reset(),n.removeAttribute("data-edit")}))}))}}))})(),(()=>{const t=document.getElementById("btn-isChildren"),n=document.getElementById("btn-isPermissions"),r=document.getElementById("btn-isAll");t.addEventListener("click",(()=>{userService.filterUsers("children").then((t=>{e(t)}))})),n.addEventListener("click",(()=>{userService.filterUsers("permissions").then((t=>{e(t)}))})),r.addEventListener("click",(()=>{userService.getUsers().then((t=>{e(t)}))}))})(),(()=>{const t=document.getElementById("sort-is-children");let n=!1;t.style.cursor="pointer",t.addEventListener("click",(()=>{userService.getSortUsers({name:"children",value:n?"asc":"desc"}).then((t=>{e(t)})),n=!n}))})(),(()=>{const t=document.getElementById("search-input"),n=((e,t=300)=>{let n;return(...r)=>{clearTimeout(n),n=setTimeout((()=>{e.apply(void 0,r)}),t)}})((()=>{userService.getSearchUsers(t.value).then((t=>{e(t)}))}));t.addEventListener("input",n)})()})();